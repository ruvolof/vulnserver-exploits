#!/usr/bin/python3

import sys
from boofuzz import *

def check_crash(target, logger, session, *args, **kwargs):
    try:
        target.open()
    except:
        logger("Unable to connect. Target is down.")
        exit(1)

def main():
    host = '192.168.1.126'
    port = 9999
    proto = 'tcp'

    if len(sys.argv) < 2:
        print("Usage: ./" + sys.argv[0] + " COMMAND")
        exit(1)

    cmd = sys.argv[1]

    session = Session(
                target = Target(
                    connection=SocketConnection(host, port, proto=proto)
                ),
              )

    s_initialize("cmd")
    s_static(cmd)
    s_delim(" ")
    s_string("FUZZ")
    s_static("\n")

    session.connect(s_get("cmd"), callback=check_crash)
    session.fuzz()

if __name__ == "__main__":
    main()
