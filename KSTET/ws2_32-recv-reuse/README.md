# KSTET exploit for Vulnserver

KSTET command is vulnerable to a stack based buffer overflow, the space available is very little. In this exploit I have used custom shellcode to call the `recv` function on the already connected socket and receive a larger payload from my machine.

The following scripts have been used to develop the full exploit:

1. kstet-recv_0poc.rb: just crash the service.
2. kstet-recv_1offsets.rb: sends a unique string to calculate offsets.
3. kstet-recv_2eip.rb: overrides EIP with a pointer to a `jmp esp`.
4. kstet-recv_3jmp.rb: jumps back to our 66 bytes buffer.
5. kstet-recv_4stager.rb: receive payload from the attacking machine.
6. kstet-recv_5exploit.rb: full exploit with payload.
7. kstet-recv_6exploit-in-esp.rb: reduce stager size to 18 bytes to fit it into the stack after EIP. Complete exploit with payload.

The following assembly has been compiled and pasted into the exploits:

1. call_recv.bin: 21 bytes long stager, used in 5 and 6 above.
2. call_recv-in-esp.bin: 18 bytes long stager, used in 7 above.

A detailed blog post about the process of writing this exploit is available here:

[https://werebug.com/exploit/vulnserver/2019/11/19/vulnserver-kstet-exploit-with-staged-payload-using-ws2-32-recv.html](https://werebug.com/exploit/vulnserver/2019/11/19/vulnserver-kstet-exploit-with-staged-payload-using-ws2-32-recv.html)
